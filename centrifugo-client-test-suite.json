{
  "name": "Centrifugo Visual Test Client - WebSocket, SSE, HTTP-Streaming, and Server API",
  "description": "Verify the Centrifugo Visual Test Client page for real-time messaging across all transports (WebSocket, SSE, HTTP-Streaming), channel subscriptions, publishing, presence tracking, chat functionality, Server HTTP API panel, tab navigation, connection logging, and button state management",
  "baseUrl": "http://localhost:8085/static/centrifugo-client.html",
  "steps": [
    "Navigate to the Centrifugo Visual Test Client page",
    "Verify the page title is 'Centrifugo Visual Test Client'",
    "Verify the header shows the title 'Centrifugo Visual Test Client' on the left and a status indicator showing 'Disconnected' with a red dot on the right",
    "Verify the left sidebar has four panels: Connection, Subscribe, Publish, and Server HTTP API",
    "Verify the Connection panel shows a Server URL field pre-filled with 'ws://localhost:8089/connection/websocket', a Transport dropdown defaulting to 'WebSocket', and a User Name field defaulting to 'tester'",
    "Verify the Connect button is enabled and the Disconnect button is disabled",
    "Verify the Subscribe panel shows a Channel field defaulting to 'chat', a disabled Subscribe button, a disabled Unsubscribe button, and 'Active Subscriptions: None'",
    "Verify the Publish panel shows a Channel field defaulting to 'chat', a JSON Data textarea with placeholder text, and a disabled Publish button",
    "Verify the Server HTTP API panel shows an API URL field that was auto-populated with a proxy path like '/api/proxy/{instance_id}/api', a Method dropdown defaulting to 'Info', a Params JSON field showing '{}', and an Execute button",
    "Verify the right main area has four tabs: Messages, Presence, Connection Log, and API Log",
    "Verify the Messages tab is active by default and shows the placeholder text 'Subscribe to a channel and send messages to see them here.'",
    "Verify the bottom status bar shows 'Transport: -', 'Client ID: -', and 'Latency: -'",
    "Verify the chat input at the bottom shows a text field with placeholder 'Type a message and press Enter...' and a Send button",

    "Click the Transport dropdown and verify it lists four options: WebSocket, HTTP-Streaming, SSE (Server-Sent Events), and WebTransport",
    "Select 'HTTP-Streaming' from the Transport dropdown and verify the Server URL automatically changes to 'http://localhost:8089/connection/http_stream'",
    "Select 'SSE (Server-Sent Events)' from the Transport dropdown and verify the Server URL automatically changes to 'http://localhost:8089/connection/sse'",
    "Select 'WebSocket' from the Transport dropdown and verify the Server URL changes back to 'ws://localhost:8089/connection/websocket'",

    "Click the Connect button to establish a WebSocket connection",
    "Verify the header status indicator changes to a green dot with text 'Connected'",
    "Verify the Connect button becomes disabled and the Disconnect button becomes enabled",
    "Verify the Subscribe and Publish buttons become enabled",
    "Verify the status bar at the bottom updates to show 'Transport: websocket' and a 'Client ID' value (a UUID string)",
    "Click the Connection Log tab and verify it contains a log entry showing 'Connected!' with the client ID and transport type in green",

    "Click the Messages tab to return to the messages view",
    "Enter 'notifications' in the Subscribe panel's Channel field and click the Subscribe button",
    "Verify 'notifications' appears as a badge under 'Active Subscriptions'",
    "Change the Channel field back to 'chat' and click the Subscribe button again",
    "Verify both 'notifications' and 'chat' appear as badges under 'Active Subscriptions'",
    "Click the Connection Log tab and verify it shows subscription success entries for both 'notifications' and 'chat' channels",

    "Click the Messages tab, then type 'Hello WebSocket!' in the chat input field at the bottom and press Enter",
    "Verify the message appears in the Messages panel showing the channel name 'chat', the username 'tester', a timestamp, and the text 'Hello WebSocket!'",
    "Type another message 'Second message test' and click the Send button instead of pressing Enter",
    "Verify both messages now appear in the Messages panel in chronological order",

    "In the Publish panel, enter 'notifications' in the Channel field",
    "Type '{\"alert\": \"System update available\", \"priority\": \"high\"}' in the JSON Data textarea",
    "Click the Publish button",
    "Verify a new message appears in the Messages panel from the 'notifications' channel containing the published JSON data",
    "Click the Connection Log tab and verify it shows a publication log entry for the 'notifications' channel",

    "Click the Presence tab",
    "Verify the Presence tab shows a 'Refresh Presence' button and a placeholder message",
    "Click the 'Refresh Presence' button",
    "Verify the presence list shows at least one entry with the current client ID and user information",

    "Select 'notifications' in the Subscribe panel's Channel field and click the Unsubscribe button",
    "Verify 'notifications' is removed from the Active Subscriptions badges, leaving only 'chat'",
    "Click the Connection Log tab and verify it shows an unsubscribe log entry for the 'notifications' channel",

    "Click the Disconnect button to close the WebSocket connection",
    "Verify the header status changes back to a red dot with 'Disconnected'",
    "Verify the Connect button becomes enabled and Disconnect becomes disabled",
    "Verify the Subscribe, Unsubscribe, and Publish buttons become disabled",
    "Verify the status bar resets to show 'Transport: -' and 'Client ID: -'",
    "Verify the Active Subscriptions resets to 'None'",
    "Click the Connection Log tab and verify it shows a 'Disconnected' entry in red",

    "Select 'HTTP-Streaming' from the Transport dropdown",
    "Verify the Server URL changes to 'http://localhost:8089/connection/http_stream'",
    "Click the Connect button",
    "Verify the header status changes to 'Connected' with a green dot",
    "Verify the status bar shows the active transport (should reflect http_stream or http-stream)",
    "Enter 'stream-channel' in the Subscribe panel's Channel field and click Subscribe",
    "Verify 'stream-channel' appears in the Active Subscriptions",
    "Type 'Hello HTTP-Streaming!' in the chat input and press Enter",
    "Verify the message appears in the Messages panel from 'stream-channel' with the text 'Hello HTTP-Streaming!'",
    "In the Publish panel, enter 'stream-channel' in the Channel field and type '{\"data\": \"streaming test\"}' in the JSON Data textarea, then click Publish",
    "Verify the published message appears in the Messages panel for 'stream-channel'",
    "Click the Connection Log tab and verify it shows connection and subscription entries for the HTTP-Streaming transport",
    "Click Disconnect and verify the connection closes cleanly with status returning to 'Disconnected'",

    "Select 'SSE (Server-Sent Events)' from the Transport dropdown",
    "Verify the Server URL changes to 'http://localhost:8089/connection/sse'",
    "Click the Connect button",
    "Verify the header status changes to 'Connected' with a green dot",
    "Verify the status bar shows the active transport (should reflect sse)",
    "Enter 'sse-channel' in the Subscribe panel's Channel field and click Subscribe",
    "Verify 'sse-channel' appears in the Active Subscriptions",
    "Type 'Hello SSE!' in the chat input and press Enter",
    "Verify the message appears in the Messages panel from 'sse-channel' with the text 'Hello SSE!'",
    "In the Publish panel, enter 'sse-channel' in the Channel field and type '{\"event\": \"sse-test\", \"value\": 42}' in the JSON Data textarea, then click Publish",
    "Verify the published message appears in the Messages panel for 'sse-channel'",
    "Click the Presence tab and click 'Refresh Presence' to verify presence works over SSE",
    "Click Disconnect and verify the connection closes cleanly",

    "Select 'WebSocket' from the Transport dropdown and click Connect to re-establish a WebSocket connection",
    "Enter 'chat' in the Subscribe panel's Channel field and click Subscribe",

    "In the Server HTTP API panel, verify the Method dropdown is set to 'Info' and Params JSON shows '{}'",
    "Click the Execute button to run the Info API call",
    "Click the API Log tab and verify it shows a 'Request' entry with '{\"method\":\"info\",\"params\":{}}' and a 'Response OK' entry containing node information with version '6.6.0 OSS'",

    "Click the Messages tab, then select 'Publish' from the API Method dropdown",
    "Verify the Params JSON field auto-populates with a publish payload template containing 'channel', 'data', 'text', and 'user' fields",
    "Modify the Params JSON to '{\"channel\": \"chat\", \"data\": {\"text\": \"Hello from Server API!\", \"user\": \"admin\"}}' and click Execute",
    "Verify a new message appears in the Messages panel from the 'chat' channel containing 'Hello from Server API!' sent by 'admin' (received via the WebSocket subscription)",
    "Click the API Log tab and verify it shows 'Response OK' for the publish call",

    "Select 'Channels' from the API Method dropdown and click Execute",
    "Click the API Log tab and verify the response contains a 'channels' object listing active channels",

    "Select 'Presence' from the API Method dropdown, verify the Params JSON shows '{\"channel\": \"chat\"}', and click Execute",
    "Click the API Log tab and verify the response contains presence data for the 'chat' channel showing the connected client",

    "Select 'Presence Stats' from the API Method dropdown, verify the Params JSON shows '{\"channel\": \"chat\"}', and click Execute",
    "Click the API Log tab and verify the response contains 'num_clients' and 'num_users' fields",

    "Select 'Broadcast' from the API Method dropdown",
    "Verify the Params JSON auto-populates with a broadcast template containing 'channels' array and 'data' object",
    "Modify the Params JSON to '{\"channels\": [\"chat\", \"news\"], \"data\": {\"text\": \"Broadcast message!\"}}' and click Execute",
    "Click the API Log tab and verify the response shows 'Response OK' confirming the broadcast was sent",

    "Select 'Subscribe (server-side)' from the API Method dropdown",
    "Verify the Params JSON auto-populates with 'user' and 'channel' fields",
    "Set the Params JSON to '{\"user\": \"remote-user\", \"channel\": \"chat\"}' and click Execute",
    "Click the API Log tab and verify the response shows 'Response OK' for the server-side subscribe",

    "Select 'Unsubscribe (server-side)' from the API Method dropdown and set Params JSON to '{\"user\": \"remote-user\", \"channel\": \"chat\"}', then click Execute",
    "Click the API Log tab and verify 'Response OK' for the unsubscribe",

    "Select 'Disconnect (server-side)' from the API Method dropdown and set Params JSON to '{\"user\": \"remote-user\"}', then click Execute",
    "Click the API Log tab and verify 'Response OK' for the disconnect command",

    "Select 'History' from the API Method dropdown, verify the Params JSON shows '{\"channel\": \"chat\"}', and click Execute",
    "Click the API Log tab and verify the response returns history data or an appropriate message if history is not configured",

    "Click the Messages tab to switch back to the messages view",
    "Verify all previously received messages (WebSocket chat, published messages, and server API published messages) are still visible in the Messages panel",
    "Click the Presence tab and verify it still shows the Refresh Presence button",
    "Click the Connection Log tab and verify it contains a chronological log of all connection events, subscriptions, publications, and errors from the entire session",
    "Click the API Log tab and verify it contains entries for all HTTP API calls made during the session (Info, Publish, Channels, Presence, Presence Stats, Broadcast, Subscribe, Unsubscribe, Disconnect, History)",

    "Click the Disconnect button to close the final WebSocket connection",
    "Verify the status returns to 'Disconnected' with a red dot, all action buttons are disabled, and the status bar resets to default values"
  ]
}
